---
title: "Pokemon Machine Learning"
author: "Aankur Bhatia"
output: html_notebook
---

Load the required packages

```{r}
all_packages=list("dplyr","caret","ggplot2","mlr","DT")

lapply(all_packages,require,character.only=TRUE)

```

load the Pokemon dataset next

```{r}
pokemon=read.csv("pokemon_alopez247.csv",stringsAsFactors = TRUE)
```

Summarize data using summarize columns command

```{r}
str(pokemon)
summarizeColumns(pokemon)
summary(pokemon)
head(pokemon)
```



Remove columns that will not be used in machine learning

1. Number
2. Name 

```{r}
pokemon$Number=NULL
pokemon$Name=NULL
```

Removing variable that have large missing values - Type_2, Egg_Group_2
```{r}
pokemon$Type_2=NULL
pokemon$Egg_Group_2=NULL
```

Keep only records with hasGender =TRUE

```{r}
library(dplyr)
table(pokemon$hasGender)
pokemon=pokemon %>%
  filter(hasGender=="True")
```

looking at the summary once again

```{r}
summarizeColumns(pokemon)
summary(pokemon)
#remove has Gender
pokemon$hasGender=NULL
str(pokemon)
#find levels of hasMegaEvolution
table(pokemon$hasMegaEvolution)
#mostly false
```

We'll do a multiclassification with Body_Style as the response variable (14 levels) using MLR Package

First let's load the MLR package, and perform data splitting

```{r}
library(mlr)
trainsample=sample(nrow(pokemon),0.6*nrow(pokemon),replace = FALSE)
testsample=setdiff(1:nrow(pokemon),trainsample)
```

Now, we create the classification task for the pokemon dataset

```{r}
pokemontraintask=makeClassifTask(data = pokemon[trainsample,],target = "Body_Style")
pokemontraintask

```

Find learners that can perform multiclass classification. Then create a benchmarking list of at-least 4-5 such learners

```{r}
poklearnersall=listLearners(pokemontraintask,warn.missing.packages = FALSE)[c("class","package")]
#we choose rpart, randomForest, Neural Network, ksvm, C50, gbm for creating the benchmark experiment
pokemonbenchlearners=list(makeLearner("classif.rpart",predict.type = "prob",fix.factors.prediction = TRUE),
                          makeLearner("classif.randomForest",predict.type = "prob",fix.factors.prediction = TRUE),
                          makeLearner("classif.nnet",predict.type = "prob",fix.factors.prediction = TRUE),
                          makeLearner("classif.boosting",predict.type = "prob",fix.factors.prediction = TRUE),
                          makeLearner("classif.C50",predict.type = "prob",fix.factors.prediction = TRUE),
                          makeLearner("classif.gbm",predict.type = "prob",fix.factors.prediction = TRUE))
pokemonbenchlearners
```

Now, we create a benchmark strategy for the resampling. We'll choose cross validation with 2 iterations. We will keep stratify =FALSE since each sample may not have all the classes

```{r}
#Resampling Strategy
pokemonresamplingbench=makeResampleDesc(method = "CV",iters=2)
pokemonresamplingbench
```

Next, we define the performance measures to be estimated for this experiment. Let's take a look at all performance measures and then select appropriate ones for this benchmarking experiment

```{r}
listMeasures(pokemontraintask)
pokemonbenchmeasures=list(kappa,multiclass.brier,acc,ber,logloss,timeboth)
pokemonbenchmeasures
```

Finally, run the benchmark experiment

```{r}
pokemonbench=benchmark(learners = pokemonbenchlearners,tasks = pokemontraintask,resamplings = pokemonresamplingbench,measures = pokemonbenchmeasures)
pokemonbench
#just perform resample using random Forest algorithm
rf.learner=makeLearner("classif.C50",predict.type = "prob",fix.factors.prediction = TRUE)
rf.resamp=makeResampleDesc("CV",iters=10)

rf.resampleexpt=resample(learner = rf.learner,task = pokemontraintask,resampling = rf.resamp,measures = pokemonbenchmeasures,extract = function(x) x$learner.model$variable.importance)
rf.resampleexpt$aggr
rf.resampleexpt$extract
rf.resampleexpt$pred

#lets try out xgboost algorithm

modds=createDummyFeatures(obj = pokemontraintask,method = "1-of-n")
modds

```

The results are obnoxious. So, we'll take a stab at predicting some other variable- Let's see the structure again

```{r}
str(pokemon)
```

Lets see the distribution of Catch_Rate

```{r}
summary(pokemon$Catch_Rate)
g1=ggplot(pokemon,aes(x=1,y=Catch_Rate))+geom_boxplot()
g2=ggplot(pokemon,aes(Catch_Rate))+geom_histogram(binwidth = 5)
library(gridExtra)
grid.arrange(g1,g2)
```

Let's try and predict the catch rate
